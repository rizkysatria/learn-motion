<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body {
  margin:0;
  background:black;
  overflow:hidden;
}
canvas {
  position:absolute;
  top:0;
  left:0;
}
video {
  display:none;
}
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script type="module">
import {
  HandLandmarker,
  FilesetResolver
} from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest";

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let objX = canvas.width/2;
let objY = canvas.height/2;
let scale = 1;
let targetScale = 1;

const vision = await FilesetResolver.forVisionTasks(
  "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"
);

const handLandmarker = await HandLandmarker.createFromOptions(vision,{
  baseOptions:{
    modelAssetPath:
    "https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/latest/hand_landmarker.task"
  },
  runningMode:"VIDEO",
  numHands:1
});

const stream = await navigator.mediaDevices.getUserMedia({video:true});
video.srcObject = stream;

video.onloadeddata = () => {
  detect();
};

function detect(){

  const results = handLandmarker.detectForVideo(video, performance.now());

  if(results.landmarks.length > 0){

    const index = results.landmarks[0][8];
    objX = (1 - index.x) * canvas.width;
    objY = index.y * canvas.height;

    const thumb = results.landmarks[0][4];

    const dx = thumb.x - index.x;
    const dy = thumb.y - index.y;
    const pinchDistance = Math.sqrt(dx*dx + dy*dy);

    const minPinch = 0.02;
    const maxPinch = 0.20;

    let normalized = (pinchDistance - minPinch) / (maxPinch - minPinch);
    normalized = Math.max(0, Math.min(1, normalized));

    if(normalized < 0.05){
      targetScale = 0.1;
    }

    targetScale = normalized * 2;
    scale += (targetScale - scale) * 0.15;
}


  draw();
  requestAnimationFrame(detect);
}

function draw(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.beginPath();
  ctx.arc(objX,objY,30 * scale,0,Math.PI*2);  
  ctx.fillStyle="#00ff88";
  ctx.fill();
}
</script>

</body>
</html>
